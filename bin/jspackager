#!/usr/bin/env php
<?php


$loaded = false;

foreach (array(__DIR__ . '/../vendor/autoload.php', __DIR__ . '/vendor/autoload.php', __DIR__ . '/../../../autoload.php') as $file) {
    if (file_exists($file)) {
        require $file;
        $loaded = true;
        break;
    }
}

if (!$loaded) {
    die(
        'You need to set up the project dependencies using the following commands:' . PHP_EOL .
        'wget http://getcomposer.org/composer.phar' . PHP_EOL .
        'php composer.phar install' . PHP_EOL
    );
}

date_default_timezone_set('America/Denver');

use JsPackager\Command;
use Symfony\Component\Console\Application;
use Symfony\Component\Console\Formatter\OutputFormatterStyle;


// Read configs for Ingestion's DB access
//$configuration = @include('config/config.php');
//if  ( !isset( $configuration['referral-ingestion'] ) )
//{
//    throw new \Exception('Malformed or missing configuration. Need referral-ingestion configuration.');
//}
//
//$referralIngestCommandDbConfig = $configuration['referral-ingestion']['app-database'];
//$druidNodeConnInfo = $configuration['referral-ingestion']['druid-connection'];


$clearFoldersCommand = new Command\ClearFoldersCommand();
$compileFoldersCommand = new Command\CompileFoldersCommand();
$compileFilesCommand = new Command\CompileFilesCommand();
$resolveFilesCommand = new Command\ResolveFilesCommand();

$console = new Application();

$console->add( $clearFoldersCommand );
$console->add( $compileFoldersCommand );
$console->add( $compileFilesCommand );
$console->add( $resolveFilesCommand );

$output = new \Symfony\Component\Console\Output\ConsoleOutput();

// Define some OutputFormatterStyle s
$output->getFormatter()->setStyle('b',          new OutputFormatterStyle(null, null, array('bold')));
$output->getFormatter()->setStyle('bold',       new OutputFormatterStyle(null, null, array('bold')));

$output->getFormatter()->setStyle('command',     new OutputFormatterStyle('cyan', null, array('bold', 'reverse')));
$output->getFormatter()->setStyle('header',     new OutputFormatterStyle('yellow', null, array()));

$output->getFormatter()->setStyle('example',    new OutputFormatterStyle('green', null, array('bold')));
$output->getFormatter()->setStyle('description',new OutputFormatterStyle('blue', null, array()));

return $console->run(null, $output);

